import { isPlatformBrowser } from '@angular/common';
import { Inject, Injectable, InjectionToken, Optional, PLATFORM_ID, } from '@angular/core';
// eslint-disable-next-line import/named
import { marked, Renderer } from 'marked';
import { Subject } from 'rxjs';
import { map } from 'rxjs/operators';
import { ClipboardButtonComponent } from './clipboard-button.component';
import { CLIPBOARD_OPTIONS } from './clipboard-options';
import { MARKED_EXTENSIONS } from './marked-extensions';
import { MARKED_OPTIONS } from './marked-options';
import { MarkedRenderer } from './marked-renderer';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@angular/platform-browser";
/* eslint-disable max-len */
export const errorJoyPixelsNotLoaded = '[ngx-markdown] When using the `emoji` attribute you *have to* include Emoji-Toolkit files to `angular.json` or use imports. See README for more information';
export const errorKatexNotLoaded = '[ngx-markdown] When using the `katex` attribute you *have to* include KaTeX files to `angular.json` or use imports. See README for more information';
export const errorMermaidNotLoaded = '[ngx-markdown] When using the `mermaid` attribute you *have to* include Mermaid files to `angular.json` or use imports. See README for more information';
export const errorClipboardNotLoaded = '[ngx-markdown] When using the `clipboard` attribute you *have to* include Clipboard files to `angular.json` or use imports. See README for more information';
export const errorClipboardViewContainerRequired = '[ngx-markdown] When using the `clipboard` attribute you *have to* provide the `viewContainerRef` parameter to `MarkdownService.render()` function';
export const errorSrcWithoutHttpClient = '[ngx-markdown] When using the `src` attribute you *have to* pass the `HttpClient` as a parameter of the `forRoot` method. See README for more information';
/* eslint-enable max-len */
export const SECURITY_CONTEXT = new InjectionToken('SECURITY_CONTEXT');
export class ExtendedRenderer extends Renderer {
    constructor() {
        super(...arguments);
        this.ɵNgxMarkdownRendererExtendedForExtensions = false;
        this.ɵNgxMarkdownRendererExtendedForMermaid = false;
    }
}
export class MarkdownService {
    get options() { return this._options; }
    set options(value) {
        this._options = { ...this.DEFAULT_MARKED_OPTIONS, ...value };
    }
    get renderer() { return this.options.renderer; }
    set renderer(value) {
        this.options.renderer = value;
    }
    constructor(clipboardOptions, extensions, options, platform, securityContext, http, sanitizer) {
        this.clipboardOptions = clipboardOptions;
        this.extensions = extensions;
        this.platform = platform;
        this.securityContext = securityContext;
        this.http = http;
        this.sanitizer = sanitizer;
        this.DEFAULT_MARKED_OPTIONS = {
            renderer: new MarkedRenderer(),
        };
        this.DEFAULT_KATEX_OPTIONS = {
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\begin{equation}', right: '\\end{equation}', display: true },
                { left: '\\begin{align}', right: '\\end{align}', display: true },
                { left: '\\begin{alignat}', right: '\\end{alignat}', display: true },
                { left: '\\begin{gather}', right: '\\end{gather}', display: true },
                { left: '\\begin{CD}', right: '\\end{CD}', display: true },
                { left: '\\[', right: '\\]', display: true },
            ],
        };
        this.DEFAULT_MERMAID_OPTIONS = {
            startOnLoad: false,
        };
        this.DEFAULT_CLIPBOARD_OPTIONS = {
            buttonComponent: undefined,
        };
        this.DEFAULT_PARSE_OPTIONS = {
            decodeHtml: false,
            inline: false,
            emoji: false,
            mermaid: false,
            markedOptions: this.DEFAULT_MARKED_OPTIONS,
            disableSanitizer: false,
        };
        this.DEFAULT_RENDER_OPTIONS = {
            clipboard: false,
            clipboardOptions: undefined,
            katex: false,
            katexOptions: undefined,
            mermaid: false,
            mermaidOptions: undefined,
        };
        this._reload$ = new Subject();
        this.reload$ = this._reload$.asObservable();
        this.options = options;
    }
    parse(markdown, parseOptions = this.DEFAULT_PARSE_OPTIONS) {
        const { decodeHtml, inline, emoji, mermaid, disableSanitizer, } = parseOptions;
        const markedOptions = {
            ...this.options,
            ...parseOptions.markedOptions,
        };
        const renderer = markedOptions.renderer || this.renderer || new Renderer();
        if (this.extensions) {
            this.renderer = this.extendsRendererForExtensions(renderer);
        }
        if (mermaid) {
            this.renderer = this.extendsRendererForMermaid(renderer);
        }
        const trimmed = this.trimIndentation(markdown);
        const decoded = decodeHtml ? this.decodeHtml(trimmed) : trimmed;
        const emojified = emoji ? this.parseEmoji(decoded) : decoded;
        const marked = this.parseMarked(emojified, markedOptions, inline);
        const sanitized = disableSanitizer ? marked : this.sanitizer.sanitize(this.securityContext, marked);
        return sanitized || '';
    }
    render(element, options = this.DEFAULT_RENDER_OPTIONS, viewContainerRef) {
        const { clipboard, clipboardOptions, katex, katexOptions, mermaid, mermaidOptions, } = options;
        if (clipboard) {
            this.renderClipboard(element, viewContainerRef, {
                ...this.DEFAULT_CLIPBOARD_OPTIONS,
                ...this.clipboardOptions,
                ...clipboardOptions,
            });
        }
        if (katex) {
            this.renderKatex(element, {
                ...this.DEFAULT_KATEX_OPTIONS,
                ...katexOptions,
            });
        }
        if (mermaid) {
            this.renderMermaid(element, {
                ...this.DEFAULT_MERMAID_OPTIONS,
                ...mermaidOptions,
            });
        }
        this.highlight(element);
    }
    reload() {
        this._reload$.next();
    }
    getSource(src) {
        if (!this.http) {
            throw new Error(errorSrcWithoutHttpClient);
        }
        return this.http
            .get(src, { responseType: 'text' })
            .pipe(map(markdown => this.handleExtension(src, markdown)));
    }
    highlight(element) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof Prism === 'undefined' || typeof Prism.highlightAllUnder === 'undefined') {
            return;
        }
        if (!element) {
            element = document;
        }
        const noLanguageElements = element.querySelectorAll('pre code:not([class*="language-"])');
        Array.prototype.forEach.call(noLanguageElements, (x) => x.classList.add('language-none'));
        Prism.highlightAllUnder(element);
    }
    decodeHtml(html) {
        if (!isPlatformBrowser(this.platform)) {
            return html;
        }
        const textarea = document.createElement('textarea');
        textarea.innerHTML = html;
        return textarea.value;
    }
    extendsRendererForExtensions(renderer) {
        const extendedRenderer = renderer;
        if (extendedRenderer.ɵNgxMarkdownRendererExtendedForExtensions === true) {
            return renderer;
        }
        if (this.extensions?.length > 0) {
            marked.use(...this.extensions);
        }
        extendedRenderer.ɵNgxMarkdownRendererExtendedForExtensions = true;
        return renderer;
    }
    extendsRendererForMermaid(renderer) {
        const extendedRenderer = renderer;
        if (extendedRenderer.ɵNgxMarkdownRendererExtendedForMermaid === true) {
            return renderer;
        }
        // eslint-disable-next-line @typescript-eslint/unbound-method
        const defaultCode = renderer.code;
        renderer.code = function (code, language, isEscaped) {
            return language === 'mermaid'
                ? `<div class="mermaid">${code}</div>`
                : defaultCode.call(this, code, language, isEscaped);
        };
        extendedRenderer.ɵNgxMarkdownRendererExtendedForMermaid = true;
        return renderer;
    }
    handleExtension(src, markdown) {
        const urlProtocolIndex = src.lastIndexOf('://');
        const urlWithoutProtocol = urlProtocolIndex > -1
            ? src.substring(urlProtocolIndex + 4)
            : src;
        const lastSlashIndex = urlWithoutProtocol.lastIndexOf('/');
        const lastUrlSegment = lastSlashIndex > -1
            ? urlWithoutProtocol.substring(lastSlashIndex + 1).split('?')[0]
            : '';
        const lastDotIndex = lastUrlSegment.lastIndexOf('.');
        const extension = lastDotIndex > -1
            ? lastUrlSegment.substring(lastDotIndex + 1)
            : '';
        return !!extension && extension !== 'md'
            ? '```' + extension + '\n' + markdown + '\n```'
            : markdown;
    }
    parseMarked(html, markedOptions, inline = false) {
        // remove renderer from markedOptions because if renderer
        // is passed to parse method, it will ignore all extensions
        if (markedOptions.renderer) {
            marked.use({ renderer: markedOptions.renderer });
            delete markedOptions.renderer;
        }
        return inline
            ? marked.parseInline(html, markedOptions)
            : marked.parse(html, markedOptions);
    }
    parseEmoji(html) {
        if (!isPlatformBrowser(this.platform)) {
            return html;
        }
        if (typeof joypixels === 'undefined' || typeof joypixels.shortnameToUnicode === 'undefined') {
            throw new Error(errorJoyPixelsNotLoaded);
        }
        return joypixels.shortnameToUnicode(html);
    }
    renderKatex(element, options) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof katex === 'undefined' || typeof renderMathInElement === 'undefined') {
            throw new Error(errorKatexNotLoaded);
        }
        renderMathInElement(element, options);
    }
    renderClipboard(element, viewContainerRef, options) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof ClipboardJS === 'undefined') {
            throw new Error(errorClipboardNotLoaded);
        }
        if (!viewContainerRef) {
            throw new Error(errorClipboardViewContainerRequired);
        }
        const { buttonComponent, buttonTemplate, } = options;
        // target every <pre> elements
        const preElements = element.querySelectorAll('pre');
        for (let i = 0; i < preElements.length; i++) {
            const preElement = preElements.item(i);
            // create <pre> wrapper element
            const preWrapperElement = document.createElement('div');
            preWrapperElement.style.position = 'relative';
            preElement.parentNode.insertBefore(preWrapperElement, preElement);
            preWrapperElement.appendChild(preElement);
            // create toolbar element
            const toolbarWrapperElement = document.createElement('div');
            toolbarWrapperElement.style.position = 'absolute';
            toolbarWrapperElement.style.top = '.5em';
            toolbarWrapperElement.style.right = '.5em';
            toolbarWrapperElement.style.opacity = '0';
            toolbarWrapperElement.style.transition = 'opacity 250ms ease-out';
            preWrapperElement.insertAdjacentElement('beforeend', toolbarWrapperElement);
            // register listener to show/hide toolbar
            preElement.onmouseover = () => toolbarWrapperElement.style.opacity = '1';
            preElement.onmouseout = () => toolbarWrapperElement.style.opacity = '0';
            // declare embeddedViewRef holding variable
            let embeddedViewRef;
            // use provided component via input property
            // or provided via ClipboardOptions provider
            if (buttonComponent) {
                const componentRef = viewContainerRef.createComponent(buttonComponent);
                embeddedViewRef = componentRef.hostView;
            }
            // use provided template via input property
            else if (buttonTemplate) {
                embeddedViewRef = viewContainerRef.createEmbeddedView(buttonTemplate);
            }
            // use default component
            else {
                const componentRef = viewContainerRef.createComponent(ClipboardButtonComponent);
                embeddedViewRef = componentRef.hostView;
            }
            // declare clipboard instance variable
            let clipboardInstance;
            // attach clipboard.js to root node
            embeddedViewRef.rootNodes.forEach((node) => {
                node.onmouseover = () => toolbarWrapperElement.style.opacity = '1';
                toolbarWrapperElement.appendChild(node);
                clipboardInstance = new ClipboardJS(node, { text: () => preElement.innerText });
            });
            // destroy clipboard instance when view is destroyed
            embeddedViewRef.onDestroy(() => clipboardInstance.destroy());
        }
    }
    renderMermaid(element, options = this.DEFAULT_MERMAID_OPTIONS) {
        if (!isPlatformBrowser(this.platform)) {
            return;
        }
        if (typeof mermaid === 'undefined' || typeof mermaid.initialize === 'undefined') {
            throw new Error(errorMermaidNotLoaded);
        }
        const mermaidElements = element.querySelectorAll('.mermaid');
        if (mermaidElements.length === 0) {
            return;
        }
        mermaid.initialize(options);
        mermaid.run({ nodes: mermaidElements });
    }
    trimIndentation(markdown) {
        if (!markdown) {
            return '';
        }
        let indentStart;
        return markdown
            .split('\n')
            .map(line => {
            let lineIdentStart = indentStart;
            if (line.length > 0) {
                lineIdentStart = isNaN(lineIdentStart)
                    ? line.search(/\S|$/)
                    : Math.min(line.search(/\S|$/), lineIdentStart);
            }
            if (isNaN(indentStart)) {
                indentStart = lineIdentStart;
            }
            return lineIdentStart
                ? line.substring(lineIdentStart)
                : line;
        }).join('\n');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.0.0", ngImport: i0, type: MarkdownService, deps: [{ token: CLIPBOARD_OPTIONS, optional: true }, { token: MARKED_EXTENSIONS, optional: true }, { token: MARKED_OPTIONS, optional: true }, { token: PLATFORM_ID }, { token: SECURITY_CONTEXT }, { token: i1.HttpClient, optional: true }, { token: i2.DomSanitizer }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.0.0", ngImport: i0, type: MarkdownService }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.0.0", ngImport: i0, type: MarkdownService, decorators: [{
            type: Injectable
        }], ctorParameters: () => [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [CLIPBOARD_OPTIONS]
                }, {
                    type: Optional
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MARKED_EXTENSIONS]
                }, {
                    type: Optional
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MARKED_OPTIONS]
                }, {
                    type: Optional
                }] }, { type: Object, decorators: [{
                    type: Inject,
                    args: [PLATFORM_ID]
                }] }, { type: i0.SecurityContext, decorators: [{
                    type: Inject,
                    args: [SECURITY_CONTEXT]
                }] }, { type: i1.HttpClient, decorators: [{
                    type: Optional
                }] }, { type: i2.DomSanitizer }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2Rvd24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2xpYi9zcmMvbWFya2Rvd24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUVwRCxPQUFPLEVBRUwsTUFBTSxFQUNOLFVBQVUsRUFDVixjQUFjLEVBQ2QsUUFBUSxFQUNSLFdBQVcsR0FHWixNQUFNLGVBQWUsQ0FBQztBQUV2Qix3Q0FBd0M7QUFDeEMsT0FBTyxFQUFFLE1BQU0sRUFBbUIsUUFBUSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzNELE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRXJDLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ3hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBNEMsTUFBTSxxQkFBcUIsQ0FBQztBQUVsRyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsY0FBYyxFQUFpQixNQUFNLGtCQUFrQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQzs7OztBQWdDbkQsNEJBQTRCO0FBQzVCLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLDZKQUE2SixDQUFDO0FBQ3JNLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLHFKQUFxSixDQUFDO0FBQ3pMLE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLHlKQUF5SixDQUFDO0FBQy9MLE1BQU0sQ0FBQyxNQUFNLHVCQUF1QixHQUFHLDZKQUE2SixDQUFDO0FBQ3JNLE1BQU0sQ0FBQyxNQUFNLG1DQUFtQyxHQUFHLG1KQUFtSixDQUFDO0FBQ3ZNLE1BQU0sQ0FBQyxNQUFNLHlCQUF5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bXBvcnQgeyBpc1BsYXRmb3JtQnJvd3NlciB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7XHJcbiAgRW1iZWRkZWRWaWV3UmVmLFxyXG4gIEluamVjdCxcclxuICBJbmplY3RhYmxlLFxyXG4gIEluamVjdGlvblRva2VuLFxyXG4gIE9wdGlvbmFsLFxyXG4gIFBMQVRGT1JNX0lELFxyXG4gIFNlY3VyaXR5Q29udGV4dCxcclxuICBWaWV3Q29udGFpbmVyUmVmLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcclxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9uYW1lZFxyXG5pbXBvcnQgeyBtYXJrZWQsIE1hcmtlZEV4dGVuc2lvbiwgUmVuZGVyZXIgfSBmcm9tICdtYXJrZWQnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmltcG9ydCB7IENsaXBib2FyZEJ1dHRvbkNvbXBvbmVudCB9IGZyb20gJy4vY2xpcGJvYXJkLWJ1dHRvbi5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBDTElQQk9BUkRfT1BUSU9OUywgQ2xpcGJvYXJkT3B0aW9ucywgQ2xpcGJvYXJkUmVuZGVyT3B0aW9ucyB9IGZyb20gJy4vY2xpcGJvYXJkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBLYXRleE9wdGlvbnMgfSBmcm9tICcuL2thdGV4LW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBNQVJLRURfRVhURU5TSU9OUyB9IGZyb20gJy4vbWFya2VkLWV4dGVuc2lvbnMnO1xyXG5pbXBvcnQgeyBNQVJLRURfT1BUSU9OUywgTWFya2VkT3B0aW9ucyB9IGZyb20gJy4vbWFya2VkLW9wdGlvbnMnO1xyXG5pbXBvcnQgeyBNYXJrZWRSZW5kZXJlciB9IGZyb20gJy4vbWFya2VkLXJlbmRlcmVyJztcclxuaW1wb3J0IHsgTWVybWFpZEFQSSB9IGZyb20gJy4vbWVybWFpZC1vcHRpb25zJztcclxuXHJcbi8vIGNsaXBib2FyZFxyXG5kZWNsYXJlIGxldCBDbGlwYm9hcmRKUzoge1xyXG4gIG5ldyAoXHJcbiAgICBzZWxlY3Rvcjogc3RyaW5nIHwgRWxlbWVudCB8IE5vZGVMaXN0T2Y8RWxlbWVudD4sXHJcbiAgICBvcHRpb25zPzogeyB0ZXh0PzogKGVsZW06IEVsZW1lbnQpID0+IHN0cmluZyB9LFxyXG4gICk6IHR5cGVvZiBDbGlwYm9hcmRKUztcclxuICBkZXN0cm95KCk6IHZvaWQ7XHJcbn07XHJcblxyXG4vLyBlbW9qaVxyXG5kZWNsYXJlIGxldCBqb3lwaXhlbHM6IHtcclxuICBzaG9ydG5hbWVUb1VuaWNvZGUoaW5wdXQ6IHN0cmluZyk6IHN0cmluZztcclxufTtcclxuXHJcbi8vIGthdGV4XHJcbmRlY2xhcmUgbGV0IGthdGV4OiB1bmtub3duO1xyXG5kZWNsYXJlIGZ1bmN0aW9uIHJlbmRlck1hdGhJbkVsZW1lbnQoZWxlbTogSFRNTEVsZW1lbnQsIG9wdGlvbnM/OiBLYXRleE9wdGlvbnMpOiB2b2lkO1xyXG5cclxuLy8gbWVybWFpZFxyXG5kZWNsYXJlIGxldCBtZXJtYWlkOiB7XHJcbiAgaW5pdGlhbGl6ZTogKG9wdGlvbnM6IE1lcm1haWRBUEkuQ29uZmlnKSA9PiB2b2lkO1xyXG4gIHJ1bjogKHJ1bk9wdGlvbnM6IE1lcm1haWRBUEkuUnVuT3B0aW9ucykgPT4gdm9pZDtcclxufTtcclxuXHJcbi8vIHByaXNtXHJcbmRlY2xhcmUgbGV0IFByaXNtOiB7XHJcbiAgaGlnaGxpZ2h0QWxsVW5kZXI6IChlbGVtZW50OiBFbGVtZW50IHwgRG9jdW1lbnQpID0+IHZvaWQ7XHJcbn07XHJcblxyXG4vKiBlc2xpbnQtZGlzYWJsZSBtYXgtbGVuICovXHJcbmV4cG9ydCBjb25zdCBlcnJvckpveVBpeGVsc05vdExvYWRlZCA9ICdbbmd4LW1hcmtkb3duXSBXaGVuIHVzaW5nIHRoZSBgZW1vamlgIGF0dHJpYnV0ZSB5b3UgKmhhdmUgdG8qIGluY2x1ZGUgRW1vamktVG9vbGtpdCBmaWxlcyB0byBgYW5ndWxhci5qc29uYCBvciB1c2UgaW1wb3J0cy4gU2VlIFJFQURNRSBmb3IgbW9yZSBpbmZvcm1hdGlvbic7XHJcbmV4cG9ydCBjb25zdCBlcnJvckthdGV4Tm90TG9hZGVkID0gJ1tuZ3gtbWFya2Rvd25dIFdoZW4gdXNpbmcgdGhlIGBrYXRleGAgYXR0cmlidXRlIHlvdSAqaGF2ZSB0byogaW5jbHVkZSBLYVRlWCBmaWxlcyB0byBgYW5ndWxhci5qc29uYCBvciB1c2UgaW1wb3J0cy4gU2VlIFJFQURNRSBmb3IgbW9yZSBpbmZvcm1hdGlvbic7XHJcbmV4cG9ydCBjb25zdCBlcnJvck1lcm1haWROb3RMb2FkZWQgPSAnW25neC1tYXJrZG93bl0gV2hlbiB1c2luZyB0aGUgYG1lcm1haWRgIGF0dHJpYnV0ZSB5b3UgKmhhdmUgdG8qIGluY2x1ZGUgTWVybWFpZCBmaWxlcyB0byBgYW5ndWxhci5qc29uYCBvciB1c2UgaW1wb3J0cy4gU2VlIFJFQURNRSBmb3IgbW9yZSBpbmZvcm1hdGlvbic7XHJcbmV4cG9ydCBjb25zdCBlcnJvckNsaXBib2FyZE5vdExvYWRlZCA9ICdbbmd4LW1hcmtkb3duXSBXaGVuIHVzaW5nIHRoZSBgY2xpcGJvYXJkYCBhdHRyaWJ1dGUgeW91ICpoYXZlIHRvKiBpbmNsdWRlIENsaXBib2FyZCBmaWxlcyB0byBgYW5ndWxhci5qc29uYCBvciB1c2UgaW1wb3J0cy4gU2VlIFJFQURNRSBmb3IgbW9yZSBpbmZvcm1hdGlvbic7XHJcbmV4cG9ydCBjb25zdCBlcnJvckNsaXBib2FyZFZpZXdDb250YWluZXJSZXF1aXJlZCA9ICdbbmd4LW1hcmtkb3duXSBXaGVuIHVzaW5nIHRoZSBgY2xpcGJvYXJkYCBhdHRyaWJ1dGUgeW91ICpoYXZlIHRvKiBwcm92aWRlIHRoZSBgdmlld0NvbnRhaW5lclJlZmAgcGFyYW1ldGVyIHRvIGBNYXJrZG93blNlcnZpY2UucmVuZGVyKClgIGZ1bmN0aW9uJztcclxuZXhwb3J0IGNvbnN0IGVycm9yU3JjV2l0aG91dEh0dHBDbGllbnQgPSAnW25neC1tYXJrZG93bl0gV2hlbiB1c2luZyB0aGUgYHNyY2AgYXR0cmlidXRlIHlvdSAqaGF2ZSB0byogcGFzcyB0aGUgYEh0dHBDbGllbnRgIGFzIGEgcGFyYW1ldGVyIG9mIHRoZSBgZm9yUm9vdGAgbWV0aG9kLiBTZWUgUkVBRE1FIGZvciBtb3JlIGluZm9ybWF0aW9uJztcclxuLyogZXNsaW50LWVuYWJsZSBtYXgtbGVuICovXHJcblxyXG5leHBvcnQgY29uc3QgU0VDVVJJVFlfQ09OVEVYVCA9IG5ldyBJbmplY3Rpb25Ub2tlbjxTZWN1cml0eUNvbnRleHQ+KCdTRUNVUklUWV9DT05URVhUJyk7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFBhcnNlT3B0aW9ucyB7XHJcbiAgZGVjb2RlSHRtbD86IGJvb2xlYW47XHJcbiAgaW5saW5lPzogYm9vbGVhbjtcclxuICBlbW9qaT86IGJvb2xlYW47XHJcbiAgbWVybWFpZD86IGJvb2xlYW47XHJcbiAgbWFya2VkT3B0aW9ucz86IE1hcmtlZE9wdGlvbnM7XHJcbiAgZGlzYWJsZVNhbml0aXplcj86IGJvb2xlYW47XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVyT3B0aW9ucyB7XHJcbiAgY2xpcGJvYXJkPzogYm9vbGVhbjtcclxuICBjbGlwYm9hcmRPcHRpb25zPzogQ2xpcGJvYXJkUmVuZGVyT3B0aW9ucztcclxuICBrYXRleD86IGJvb2xlYW47XHJcbiAga2F0ZXhPcHRpb25zPzogS2F0ZXhPcHRpb25zO1xyXG4gIG1lcm1haWQ/OiBib29sZWFuO1xyXG4gIG1lcm1haWRPcHRpb25zPzogTWVybWFpZEFQSS5Db25maWc7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBFeHRlbmRlZFJlbmRlcmVyIGV4dGVuZHMgUmVuZGVyZXIge1xyXG4gIMm1Tmd4TWFya2Rvd25SZW5kZXJlckV4dGVuZGVkRm9yRXh0ZW5zaW9ucyA9IGZhbHNlO1xyXG4gIMm1Tmd4TWFya2Rvd25SZW5kZXJlckV4dGVuZGVkRm9yTWVybWFpZCA9IGZhbHNlO1xyXG59XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBNYXJrZG93blNlcnZpY2Uge1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfTUFSS0VEX09QVElPTlM6IE1hcmtlZE9wdGlvbnMgPSB7XHJcbiAgICByZW5kZXJlcjogbmV3IE1hcmtlZFJlbmRlcmVyKCksXHJcbiAgfTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBERUZBVUxUX0tBVEVYX09QVElPTlM6IEthdGV4T3B0aW9ucyA9IHtcclxuICAgIGRlbGltaXRlcnM6IFtcclxuICAgICAgeyBsZWZ0OiAnJCQnLCByaWdodDogJyQkJywgZGlzcGxheTogdHJ1ZSB9LFxyXG4gICAgICB7IGxlZnQ6ICckJywgcmlnaHQ6ICckJywgZGlzcGxheTogZmFsc2UgfSxcclxuICAgICAgeyBsZWZ0OiAnXFxcXCgnLCByaWdodDogJ1xcXFwpJywgZGlzcGxheTogZmFsc2UgfSxcclxuICAgICAgeyBsZWZ0OiAnXFxcXGJlZ2lue2VxdWF0aW9ufScsIHJpZ2h0OiAnXFxcXGVuZHtlcXVhdGlvbn0nLCBkaXNwbGF5OiB0cnVlIH0sXHJcbiAgICAgIHsgbGVmdDogJ1xcXFxiZWdpbnthbGlnbn0nLCByaWdodDogJ1xcXFxlbmR7YWxpZ259JywgZGlzcGxheTogdHJ1ZSB9LFxyXG4gICAgICB7IGxlZnQ6ICdcXFxcYmVnaW57YWxpZ25hdH0nLCByaWdodDogJ1xcXFxlbmR7YWxpZ25hdH0nLCBkaXNwbGF5OiB0cnVlIH0sXHJcbiAgICAgIHsgbGVmdDogJ1xcXFxiZWdpbntnYXRoZXJ9JywgcmlnaHQ6ICdcXFxcZW5ke2dhdGhlcn0nLCBkaXNwbGF5OiB0cnVlIH0sXHJcbiAgICAgIHsgbGVmdDogJ1xcXFxiZWdpbntDRH0nLCByaWdodDogJ1xcXFxlbmR7Q0R9JywgZGlzcGxheTogdHJ1ZSB9LFxyXG4gICAgICB7IGxlZnQ6ICdcXFxcWycsIHJpZ2h0OiAnXFxcXF0nLCBkaXNwbGF5OiB0cnVlIH0sXHJcbiAgICBdLFxyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9NRVJNQUlEX09QVElPTlM6IE1lcm1haWRBUEkuQ29uZmlnID0ge1xyXG4gICAgc3RhcnRPbkxvYWQ6IGZhbHNlLFxyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9DTElQQk9BUkRfT1BUSU9OUzogQ2xpcGJvYXJkT3B0aW9ucyA9IHtcclxuICAgIGJ1dHRvbkNvbXBvbmVudDogdW5kZWZpbmVkLFxyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9QQVJTRV9PUFRJT05TOiBQYXJzZU9wdGlvbnMgPSB7XHJcbiAgICBkZWNvZGVIdG1sOiBmYWxzZSxcclxuICAgIGlubGluZTogZmFsc2UsXHJcbiAgICBlbW9qaTogZmFsc2UsXHJcbiAgICBtZXJtYWlkOiBmYWxzZSxcclxuICAgIG1hcmtlZE9wdGlvbnM6IHRoaXMuREVGQVVMVF9NQVJLRURfT1BUSU9OUyxcclxuICAgIGRpc2FibGVTYW5pdGl6ZXI6IGZhbHNlLFxyXG4gIH07XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgREVGQVVMVF9SRU5ERVJfT1BUSU9OUzogUmVuZGVyT3B0aW9ucyA9IHtcclxuICAgIGNsaXBib2FyZDogZmFsc2UsXHJcbiAgICBjbGlwYm9hcmRPcHRpb25zOiB1bmRlZmluZWQsXHJcbiAgICBrYXRleDogZmFsc2UsXHJcbiAgICBrYXRleE9wdGlvbnM6IHVuZGVmaW5lZCxcclxuICAgIG1lcm1haWQ6IGZhbHNlLFxyXG4gICAgbWVybWFpZE9wdGlvbnM6IHVuZGVmaW5lZCxcclxuICB9O1xyXG5cclxuICBwcml2YXRlIF9vcHRpb25zOiBNYXJrZWRPcHRpb25zIHwgdW5kZWZpbmVkO1xyXG5cclxuICBnZXQgb3B0aW9ucygpOiBNYXJrZWRPcHRpb25zIHsgcmV0dXJuIHRoaXMuX29wdGlvbnMhOyB9XHJcbiAgc2V0IG9wdGlvbnModmFsdWU6IE1hcmtlZE9wdGlvbnMgfCB1bmRlZmluZWQpIHtcclxuICAgIHRoaXMuX29wdGlvbnMgPSB7IC4uLnRoaXMuREVGQVVMVF9NQVJLRURfT1BUSU9OUywgLi4udmFsdWUgfTtcclxuICB9XHJcblxyXG4gIGdldCByZW5kZXJlcigpOiBNYXJrZWRSZW5kZXJlciB7IHJldHVybiB0aGlzLm9wdGlvbnMucmVuZGVyZXIhOyB9XHJcbiAgc2V0IHJlbmRlcmVyKHZhbHVlOiBNYXJrZWRSZW5kZXJlcikge1xyXG4gICAgdGhpcy5vcHRpb25zLnJlbmRlcmVyID0gdmFsdWU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9yZWxvYWQkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuICByZWFkb25seSByZWxvYWQkID0gdGhpcy5fcmVsb2FkJC5hc09ic2VydmFibGUoKTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBASW5qZWN0KENMSVBCT0FSRF9PUFRJT05TKSBAT3B0aW9uYWwoKSBwcml2YXRlIGNsaXBib2FyZE9wdGlvbnM6IENsaXBib2FyZE9wdGlvbnMsXHJcbiAgICBASW5qZWN0KE1BUktFRF9FWFRFTlNJT05TKSBAT3B0aW9uYWwoKSBwcml2YXRlIGV4dGVuc2lvbnM6IE1hcmtlZEV4dGVuc2lvbltdLFxyXG4gICAgQEluamVjdChNQVJLRURfT1BUSU9OUykgQE9wdGlvbmFsKCkgb3B0aW9uczogTWFya2VkT3B0aW9ucyxcclxuICAgIEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm06IE9iamVjdCxcclxuICAgIEBJbmplY3QoU0VDVVJJVFlfQ09OVEVYVCkgcHJpdmF0ZSBzZWN1cml0eUNvbnRleHQ6IFNlY3VyaXR5Q29udGV4dCxcclxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcclxuICAgIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsXHJcbiAgKSB7XHJcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xyXG4gIH1cclxuXHJcbiAgcGFyc2UobWFya2Rvd246IHN0cmluZywgcGFyc2VPcHRpb25zOiBQYXJzZU9wdGlvbnMgPSB0aGlzLkRFRkFVTFRfUEFSU0VfT1BUSU9OUyk6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPiB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGRlY29kZUh0bWwsXHJcbiAgICAgIGlubGluZSxcclxuICAgICAgZW1vamksXHJcbiAgICAgIG1lcm1haWQsXHJcbiAgICAgIGRpc2FibGVTYW5pdGl6ZXIsXHJcbiAgICB9ID0gcGFyc2VPcHRpb25zO1xyXG5cclxuICAgIGNvbnN0IG1hcmtlZE9wdGlvbnMgPSB7XHJcbiAgICAgIC4uLnRoaXMub3B0aW9ucyxcclxuICAgICAgLi4ucGFyc2VPcHRpb25zLm1hcmtlZE9wdGlvbnMsXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IHJlbmRlcmVyID0gbWFya2VkT3B0aW9ucy5yZW5kZXJlciB8fCB0aGlzLnJlbmRlcmVyIHx8IG5ldyBSZW5kZXJlcigpO1xyXG5cclxuICAgIGlmICh0aGlzLmV4dGVuc2lvbnMpIHtcclxuICAgICAgdGhpcy5yZW5kZXJlciA9IHRoaXMuZXh0ZW5kc1JlbmRlcmVyRm9yRXh0ZW5zaW9ucyhyZW5kZXJlcik7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG1lcm1haWQpIHtcclxuICAgICAgdGhpcy5yZW5kZXJlciA9IHRoaXMuZXh0ZW5kc1JlbmRlcmVyRm9yTWVybWFpZChyZW5kZXJlcik7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdHJpbW1lZCA9IHRoaXMudHJpbUluZGVudGF0aW9uKG1hcmtkb3duKTtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGVIdG1sID8gdGhpcy5kZWNvZGVIdG1sKHRyaW1tZWQpIDogdHJpbW1lZDtcclxuICAgIGNvbnN0IGVtb2ppZmllZCA9IGVtb2ppID8gdGhpcy5wYXJzZUVtb2ppKGRlY29kZWQpIDogZGVjb2RlZDtcclxuICAgIGNvbnN0IG1hcmtlZCA9IHRoaXMucGFyc2VNYXJrZWQoZW1vamlmaWVkLCBtYXJrZWRPcHRpb25zLCBpbmxpbmUpO1xyXG4gICAgY29uc3Qgc2FuaXRpemVkID0gZGlzYWJsZVNhbml0aXplciA/IG1hcmtlZCA6IHRoaXMuc2FuaXRpemVyLnNhbml0aXplKHRoaXMuc2VjdXJpdHlDb250ZXh0LCBtYXJrZWQpO1xyXG5cclxuICAgIHJldHVybiBzYW5pdGl6ZWQgfHwgJyc7XHJcbiAgfVxyXG5cclxuICByZW5kZXIoZWxlbWVudDogSFRNTEVsZW1lbnQsIG9wdGlvbnM6IFJlbmRlck9wdGlvbnMgPSB0aGlzLkRFRkFVTFRfUkVOREVSX09QVElPTlMsIHZpZXdDb250YWluZXJSZWY/OiBWaWV3Q29udGFpbmVyUmVmKTogdm9pZCB7XHJcbiAgICBjb25zdCB7XHJcbiAgICAgIGNsaXBib2FyZCxcclxuICAgICAgY2xpcGJvYXJkT3B0aW9ucyxcclxuICAgICAga2F0ZXgsXHJcbiAgICAgIGthdGV4T3B0aW9ucyxcclxuICAgICAgbWVybWFpZCxcclxuICAgICAgbWVybWFpZE9wdGlvbnMsXHJcbiAgICB9ID0gb3B0aW9ucztcclxuXHJcbiAgICBpZiAoY2xpcGJvYXJkKSB7XHJcbiAgICAgIHRoaXMucmVuZGVyQ2xpcGJvYXJkKGVsZW1lbnQsIHZpZXdDb250YWluZXJSZWYsIHtcclxuICAgICAgICAuLi50aGlzLkRFRkFVTFRfQ0xJUEJPQVJEX09QVElPTlMsXHJcbiAgICAgICAgLi4udGhpcy5jbGlwYm9hcmRPcHRpb25zLFxyXG4gICAgICAgIC4uLmNsaXBib2FyZE9wdGlvbnMsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKGthdGV4KSB7XHJcbiAgICAgIHRoaXMucmVuZGVyS2F0ZXgoZWxlbWVudCwge1xyXG4gICAgICAgIC4uLnRoaXMuREVGQVVMVF9LQVRFWF9PUFRJT05TLFxyXG4gICAgICAgIC4uLmthdGV4T3B0aW9ucyxcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAobWVybWFpZCkge1xyXG4gICAgICB0aGlzLnJlbmRlck1lcm1haWQoZWxlbWVudCwge1xyXG4gICAgICAgIC4uLnRoaXMuREVGQVVMVF9NRVJNQUlEX09QVElPTlMsXHJcbiAgICAgICAgLi4ubWVybWFpZE9wdGlvbnMsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaGlnaGxpZ2h0KGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgcmVsb2FkKCk6IHZvaWQge1xyXG4gICAgdGhpcy5fcmVsb2FkJC5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICBnZXRTb3VyY2Uoc3JjOiBzdHJpbmcpOiBPYnNlcnZhYmxlPHN0cmluZz4ge1xyXG4gICAgaWYgKCF0aGlzLmh0dHApIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yU3JjV2l0aG91dEh0dHBDbGllbnQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cFxyXG4gICAgICAuZ2V0KHNyYywgeyByZXNwb25zZVR5cGU6ICd0ZXh0JyB9KVxyXG4gICAgICAucGlwZShtYXAobWFya2Rvd24gPT4gdGhpcy5oYW5kbGVFeHRlbnNpb24oc3JjLCBtYXJrZG93bikpKTtcclxuICB9XHJcblxyXG4gIGhpZ2hsaWdodChlbGVtZW50PzogRWxlbWVudCB8IERvY3VtZW50KTogdm9pZCB7XHJcbiAgICBpZiAoIWlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgUHJpc20gPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBQcmlzbS5oaWdobGlnaHRBbGxVbmRlciA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKCFlbGVtZW50KSB7XHJcbiAgICAgIGVsZW1lbnQgPSBkb2N1bWVudDtcclxuICAgIH1cclxuICAgIGNvbnN0IG5vTGFuZ3VhZ2VFbGVtZW50cyA9IGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgncHJlIGNvZGU6bm90KFtjbGFzcyo9XCJsYW5ndWFnZS1cIl0pJyk7XHJcbiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKG5vTGFuZ3VhZ2VFbGVtZW50cywgKHg6IEVsZW1lbnQpID0+IHguY2xhc3NMaXN0LmFkZCgnbGFuZ3VhZ2Utbm9uZScpKTtcclxuICAgIFByaXNtLmhpZ2hsaWdodEFsbFVuZGVyKGVsZW1lbnQpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBkZWNvZGVIdG1sKGh0bWw6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBpZiAoIWlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XHJcbiAgICAgIHJldHVybiBodG1sO1xyXG4gICAgfVxyXG4gICAgY29uc3QgdGV4dGFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpO1xyXG4gICAgdGV4dGFyZWEuaW5uZXJIVE1MID0gaHRtbDtcclxuICAgIHJldHVybiB0ZXh0YXJlYS52YWx1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZXh0ZW5kc1JlbmRlcmVyRm9yRXh0ZW5zaW9ucyhyZW5kZXJlcjogUmVuZGVyZXIpOiBSZW5kZXJlciB7XHJcbiAgICBjb25zdCBleHRlbmRlZFJlbmRlcmVyID0gcmVuZGVyZXIgYXMgRXh0ZW5kZWRSZW5kZXJlcjtcclxuICAgIGlmIChleHRlbmRlZFJlbmRlcmVyLsm1Tmd4TWFya2Rvd25SZW5kZXJlckV4dGVuZGVkRm9yRXh0ZW5zaW9ucyA9PT0gdHJ1ZSkge1xyXG4gICAgICByZXR1cm4gcmVuZGVyZXI7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuZXh0ZW5zaW9ucz8ubGVuZ3RoID4gMCkge1xyXG4gICAgICBtYXJrZWQudXNlKC4uLnRoaXMuZXh0ZW5zaW9ucyk7XHJcbiAgICB9XHJcblxyXG4gICAgZXh0ZW5kZWRSZW5kZXJlci7JtU5neE1hcmtkb3duUmVuZGVyZXJFeHRlbmRlZEZvckV4dGVuc2lvbnMgPSB0cnVlO1xyXG5cclxuICAgIHJldHVybiByZW5kZXJlcjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZXh0ZW5kc1JlbmRlcmVyRm9yTWVybWFpZChyZW5kZXJlcjogUmVuZGVyZXIpOiBSZW5kZXJlciB7XHJcbiAgICBjb25zdCBleHRlbmRlZFJlbmRlcmVyID0gcmVuZGVyZXIgYXMgRXh0ZW5kZWRSZW5kZXJlcjtcclxuICAgIGlmIChleHRlbmRlZFJlbmRlcmVyLsm1Tmd4TWFya2Rvd25SZW5kZXJlckV4dGVuZGVkRm9yTWVybWFpZCA9PT0gdHJ1ZSkge1xyXG4gICAgICByZXR1cm4gcmVuZGVyZXI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC91bmJvdW5kLW1ldGhvZFxyXG4gICAgY29uc3QgZGVmYXVsdENvZGUgPSByZW5kZXJlci5jb2RlO1xyXG4gICAgcmVuZGVyZXIuY29kZSA9IGZ1bmN0aW9uIChjb2RlOiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcgfCB1bmRlZmluZWQsIGlzRXNjYXBlZDogYm9vbGVhbikge1xyXG4gICAgICByZXR1cm4gbGFuZ3VhZ2UgPT09ICdtZXJtYWlkJ1xyXG4gICAgICAgID8gYDxkaXYgY2xhc3M9XCJtZXJtYWlkXCI+JHtjb2RlfTwvZGl2PmBcclxuICAgICAgICA6IGRlZmF1bHRDb2RlLmNhbGwodGhpcywgY29kZSwgbGFuZ3VhZ2UsIGlzRXNjYXBlZCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4dGVuZGVkUmVuZGVyZXIuybVOZ3hNYXJrZG93blJlbmRlcmVyRXh0ZW5kZWRGb3JNZXJtYWlkID0gdHJ1ZTtcclxuXHJcbiAgICByZXR1cm4gcmVuZGVyZXI7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGhhbmRsZUV4dGVuc2lvbihzcmM6IHN0cmluZywgbWFya2Rvd246IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCB1cmxQcm90b2NvbEluZGV4ID0gc3JjLmxhc3RJbmRleE9mKCc6Ly8nKTtcclxuICAgIGNvbnN0IHVybFdpdGhvdXRQcm90b2NvbCA9IHVybFByb3RvY29sSW5kZXggPiAtMVxyXG4gICAgICA/IHNyYy5zdWJzdHJpbmcodXJsUHJvdG9jb2xJbmRleCArIDQpXHJcbiAgICAgIDogc3JjO1xyXG5cclxuICAgIGNvbnN0IGxhc3RTbGFzaEluZGV4ID0gdXJsV2l0aG91dFByb3RvY29sLmxhc3RJbmRleE9mKCcvJyk7XHJcbiAgICBjb25zdCBsYXN0VXJsU2VnbWVudCA9IGxhc3RTbGFzaEluZGV4ID4gLTFcclxuICAgICAgPyB1cmxXaXRob3V0UHJvdG9jb2wuc3Vic3RyaW5nKGxhc3RTbGFzaEluZGV4ICsgMSkuc3BsaXQoJz8nKVswXVxyXG4gICAgICA6ICcnO1xyXG5cclxuICAgIGNvbnN0IGxhc3REb3RJbmRleCA9IGxhc3RVcmxTZWdtZW50Lmxhc3RJbmRleE9mKCcuJyk7XHJcbiAgICBjb25zdCBleHRlbnNpb24gPSBsYXN0RG90SW5kZXggPiAtMVxyXG4gICAgICA/IGxhc3RVcmxTZWdtZW50LnN1YnN0cmluZyhsYXN0RG90SW5kZXggKyAxKVxyXG4gICAgICA6ICcnO1xyXG5cclxuICAgIHJldHVybiAhIWV4dGVuc2lvbiAmJiBleHRlbnNpb24gIT09ICdtZCdcclxuICAgICAgPyAnYGBgJyArIGV4dGVuc2lvbiArICdcXG4nICsgbWFya2Rvd24gKyAnXFxuYGBgJ1xyXG4gICAgICA6IG1hcmtkb3duO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYXJzZU1hcmtlZChodG1sOiBzdHJpbmcsIG1hcmtlZE9wdGlvbnM6IE1hcmtlZE9wdGlvbnMsIGlubGluZSA9IGZhbHNlKTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+IHtcclxuICAgIC8vIHJlbW92ZSByZW5kZXJlciBmcm9tIG1hcmtlZE9wdGlvbnMgYmVjYXVzZSBpZiByZW5kZXJlclxyXG4gICAgLy8gaXMgcGFzc2VkIHRvIHBhcnNlIG1ldGhvZCwgaXQgd2lsbCBpZ25vcmUgYWxsIGV4dGVuc2lvbnNcclxuICAgIGlmIChtYXJrZWRPcHRpb25zLnJlbmRlcmVyKSB7XHJcbiAgICAgIG1hcmtlZC51c2UoeyByZW5kZXJlcjogbWFya2VkT3B0aW9ucy5yZW5kZXJlciB9KTtcclxuICAgICAgZGVsZXRlIG1hcmtlZE9wdGlvbnMucmVuZGVyZXI7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGlubGluZVxyXG4gICAgICA/IG1hcmtlZC5wYXJzZUlubGluZShodG1sLCBtYXJrZWRPcHRpb25zKVxyXG4gICAgICA6IG1hcmtlZC5wYXJzZShodG1sLCBtYXJrZWRPcHRpb25zKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcGFyc2VFbW9qaShodG1sOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xyXG4gICAgICByZXR1cm4gaHRtbDtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Ygam95cGl4ZWxzID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2Ygam95cGl4ZWxzLnNob3J0bmFtZVRvVW5pY29kZSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9ySm95UGl4ZWxzTm90TG9hZGVkKTtcclxuICAgIH1cclxuICAgIHJldHVybiBqb3lwaXhlbHMuc2hvcnRuYW1lVG9Vbmljb2RlKGh0bWwpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJLYXRleChlbGVtZW50OiBIVE1MRWxlbWVudCwgb3B0aW9uczogS2F0ZXhPcHRpb25zKTogdm9pZCB7XHJcbiAgICBpZiAoIWlzUGxhdGZvcm1Ccm93c2VyKHRoaXMucGxhdGZvcm0pKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2Yga2F0ZXggPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiByZW5kZXJNYXRoSW5FbGVtZW50ID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JLYXRleE5vdExvYWRlZCk7XHJcbiAgICB9XHJcbiAgICByZW5kZXJNYXRoSW5FbGVtZW50KGVsZW1lbnQsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJDbGlwYm9hcmQoZWxlbWVudDogSFRNTEVsZW1lbnQsIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYgfCB1bmRlZmluZWQsIG9wdGlvbnM6IENsaXBib2FyZFJlbmRlck9wdGlvbnMpOiB2b2lkIHtcclxuICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybSkpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBDbGlwYm9hcmRKUyA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yQ2xpcGJvYXJkTm90TG9hZGVkKTtcclxuICAgIH1cclxuICAgIGlmICghdmlld0NvbnRhaW5lclJlZikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JDbGlwYm9hcmRWaWV3Q29udGFpbmVyUmVxdWlyZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHtcclxuICAgICAgYnV0dG9uQ29tcG9uZW50LFxyXG4gICAgICBidXR0b25UZW1wbGF0ZSxcclxuICAgIH0gPSBvcHRpb25zO1xyXG5cclxuICAgIC8vIHRhcmdldCBldmVyeSA8cHJlPiBlbGVtZW50c1xyXG4gICAgY29uc3QgcHJlRWxlbWVudHMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3ByZScpO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcmVFbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCBwcmVFbGVtZW50ID0gcHJlRWxlbWVudHMuaXRlbShpKTtcclxuXHJcbiAgICAgIC8vIGNyZWF0ZSA8cHJlPiB3cmFwcGVyIGVsZW1lbnRcclxuICAgICAgY29uc3QgcHJlV3JhcHBlckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgcHJlV3JhcHBlckVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xyXG4gICAgICBwcmVFbGVtZW50LnBhcmVudE5vZGUhLmluc2VydEJlZm9yZShwcmVXcmFwcGVyRWxlbWVudCwgcHJlRWxlbWVudCk7XHJcbiAgICAgIHByZVdyYXBwZXJFbGVtZW50LmFwcGVuZENoaWxkKHByZUVsZW1lbnQpO1xyXG5cclxuICAgICAgLy8gY3JlYXRlIHRvb2xiYXIgZWxlbWVudFxyXG4gICAgICBjb25zdCB0b29sYmFyV3JhcHBlckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgdG9vbGJhcldyYXBwZXJFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICAgICAgdG9vbGJhcldyYXBwZXJFbGVtZW50LnN0eWxlLnRvcCA9ICcuNWVtJztcclxuICAgICAgdG9vbGJhcldyYXBwZXJFbGVtZW50LnN0eWxlLnJpZ2h0ID0gJy41ZW0nO1xyXG4gICAgICB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUub3BhY2l0eSA9ICcwJztcclxuICAgICAgdG9vbGJhcldyYXBwZXJFbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSAnb3BhY2l0eSAyNTBtcyBlYXNlLW91dCc7XHJcbiAgICAgIHByZVdyYXBwZXJFbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudCgnYmVmb3JlZW5kJywgdG9vbGJhcldyYXBwZXJFbGVtZW50KTtcclxuXHJcbiAgICAgIC8vIHJlZ2lzdGVyIGxpc3RlbmVyIHRvIHNob3cvaGlkZSB0b29sYmFyXHJcbiAgICAgIHByZUVsZW1lbnQub25tb3VzZW92ZXIgPSAoKSA9PiB0b29sYmFyV3JhcHBlckVsZW1lbnQuc3R5bGUub3BhY2l0eSA9ICcxJztcclxuICAgICAgcHJlRWxlbWVudC5vbm1vdXNlb3V0ID0gKCkgPT4gdG9vbGJhcldyYXBwZXJFbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAnMCc7XHJcblxyXG4gICAgICAvLyBkZWNsYXJlIGVtYmVkZGVkVmlld1JlZiBob2xkaW5nIHZhcmlhYmxlXHJcbiAgICAgIGxldCBlbWJlZGRlZFZpZXdSZWY6IEVtYmVkZGVkVmlld1JlZjx1bmtub3duPjtcclxuXHJcbiAgICAgIC8vIHVzZSBwcm92aWRlZCBjb21wb25lbnQgdmlhIGlucHV0IHByb3BlcnR5XHJcbiAgICAgIC8vIG9yIHByb3ZpZGVkIHZpYSBDbGlwYm9hcmRPcHRpb25zIHByb3ZpZGVyXHJcbiAgICAgIGlmIChidXR0b25Db21wb25lbnQpIHtcclxuICAgICAgICBjb25zdCBjb21wb25lbnRSZWYgPSB2aWV3Q29udGFpbmVyUmVmLmNyZWF0ZUNvbXBvbmVudChidXR0b25Db21wb25lbnQpO1xyXG4gICAgICAgIGVtYmVkZGVkVmlld1JlZiA9IGNvbXBvbmVudFJlZi5ob3N0VmlldyBhcyBFbWJlZGRlZFZpZXdSZWY8dW5rbm93bj47XHJcbiAgICAgIH1cclxuICAgICAgLy8gdXNlIHByb3ZpZGVkIHRlbXBsYXRlIHZpYSBpbnB1dCBwcm9wZXJ0eVxyXG4gICAgICBlbHNlIGlmIChidXR0b25UZW1wbGF0ZSkge1xyXG4gICAgICAgIGVtYmVkZGVkVmlld1JlZiA9IHZpZXdDb250YWluZXJSZWYuY3JlYXRlRW1iZWRkZWRWaWV3KGJ1dHRvblRlbXBsYXRlKTtcclxuICAgICAgfVxyXG4gICAgICAvLyB1c2UgZGVmYXVsdCBjb21wb25lbnRcclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgY29uc3QgY29tcG9uZW50UmVmID0gdmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoQ2xpcGJvYXJkQnV0dG9uQ29tcG9uZW50KTtcclxuICAgICAgICBlbWJlZGRlZFZpZXdSZWYgPSBjb21wb25lbnRSZWYuaG9zdFZpZXcgYXMgRW1iZWRkZWRWaWV3UmVmPHVua25vd24+O1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBkZWNsYXJlIGNsaXBib2FyZCBpbnN0YW5jZSB2YXJpYWJsZVxyXG4gICAgICBsZXQgY2xpcGJvYXJkSW5zdGFuY2U6IHR5cGVvZiBDbGlwYm9hcmRKUztcclxuXHJcbiAgICAgIC8vIGF0dGFjaCBjbGlwYm9hcmQuanMgdG8gcm9vdCBub2RlXHJcbiAgICAgIGVtYmVkZGVkVmlld1JlZi5yb290Tm9kZXMuZm9yRWFjaCgobm9kZTogSFRNTEVsZW1lbnQpID0+IHtcclxuICAgICAgICBub2RlLm9ubW91c2VvdmVyID0gKCkgPT4gdG9vbGJhcldyYXBwZXJFbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAnMSc7XHJcbiAgICAgICAgdG9vbGJhcldyYXBwZXJFbGVtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xyXG4gICAgICAgIGNsaXBib2FyZEluc3RhbmNlID0gbmV3IENsaXBib2FyZEpTKG5vZGUsIHsgdGV4dDogKCkgPT4gcHJlRWxlbWVudC5pbm5lclRleHQgfSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gZGVzdHJveSBjbGlwYm9hcmQgaW5zdGFuY2Ugd2hlbiB2aWV3IGlzIGRlc3Ryb3llZFxyXG4gICAgICBlbWJlZGRlZFZpZXdSZWYub25EZXN0cm95KCgpID0+IGNsaXBib2FyZEluc3RhbmNlLmRlc3Ryb3koKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlbmRlck1lcm1haWQoZWxlbWVudDogSFRNTEVsZW1lbnQsIG9wdGlvbnM6IE1lcm1haWRBUEkuQ29uZmlnID0gdGhpcy5ERUZBVUxUX01FUk1BSURfT1BUSU9OUyk6IHZvaWQge1xyXG4gICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG1lcm1haWQgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBtZXJtYWlkLmluaXRpYWxpemUgPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lcm1haWROb3RMb2FkZWQpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgbWVybWFpZEVsZW1lbnRzID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PignLm1lcm1haWQnKTtcclxuICAgIGlmIChtZXJtYWlkRWxlbWVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIG1lcm1haWQuaW5pdGlhbGl6ZShvcHRpb25zKTtcclxuICAgIG1lcm1haWQucnVuKHsgbm9kZXM6IG1lcm1haWRFbGVtZW50cyB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgdHJpbUluZGVudGF0aW9uKG1hcmtkb3duOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgaWYgKCFtYXJrZG93bikge1xyXG4gICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgICBsZXQgaW5kZW50U3RhcnQ6IG51bWJlcjtcclxuICAgIHJldHVybiBtYXJrZG93blxyXG4gICAgICAuc3BsaXQoJ1xcbicpXHJcbiAgICAgIC5tYXAobGluZSA9PiB7XHJcbiAgICAgICAgbGV0IGxpbmVJZGVudFN0YXJ0ID0gaW5kZW50U3RhcnQ7XHJcbiAgICAgICAgaWYgKGxpbmUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgbGluZUlkZW50U3RhcnQgPSBpc05hTihsaW5lSWRlbnRTdGFydClcclxuICAgICAgICAgICAgPyBsaW5lLnNlYXJjaCgvXFxTfCQvKVxyXG4gICAgICAgICAgICA6IE1hdGgubWluKGxpbmUuc2VhcmNoKC9cXFN8JC8pLCBsaW5lSWRlbnRTdGFydCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc05hTihpbmRlbnRTdGFydCkpIHtcclxuICAgICAgICAgIGluZGVudFN0YXJ0ID0gbGluZUlkZW50U3RhcnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBsaW5lSWRlbnRTdGFydFxyXG4gICAgICAgICAgPyBsaW5lLnN1YnN0cmluZyhsaW5lSWRlbnRTdGFydClcclxuICAgICAgICAgIDogbGluZTtcclxuICAgICAgfSkuam9pbignXFxuJyk7XHJcbiAgfVxyXG59XHJcbiJdfQ==