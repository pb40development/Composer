const a3_0x23f7=['data','parse','../../../utilities/metric-logger','note','../../../utilities/environment','next','devDependencies','/nx-cloud/runs/start','length','post','/nx-cloud/runs/end','string','../../../utilities/is-private-cloud','RunStart\x20duration','nxCloudVersion','...','createApiAxiosInstance','success','apiAxiosInstance','mapRespToPerfEntry','startRun','unknown','package.json','message','defaults','__esModule','from','throw','axiosMultipleTries','getRunGroup','error','apiError','messages','Invalid\x20Nx\x20Cloud\x20response:\x20','application/octet-stream','stringify','RUNNER_FAILURE_PERF_ENTRY','response','gzip','recordMetric','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','stack','readFileSync','printDuration','value','status','extractErrorMessage','map','CloudRunApi','runUrl','isConnectedToPrivateCloud','RunEnd.\x20Completed\x20tasks','createReqBody','done','toString','api','../../../utilities/axios','urls','assign','getCIExecutionId','createMetricRecorder','@nrwl/nx-cloud','defineProperty','Invalid\x20end\x20run\x20response:\x20','axiosException','getCIExecutionEnv','runContext','VERBOSE_LOGGING','slice','terminalOutput','endRun','machineInfo'];(function(_0x5e3d5f,_0x23f73e){const _0x2bc56f=function(_0x4d0cc2){while(--_0x4d0cc2){_0x5e3d5f['push'](_0x5e3d5f['shift']());}};_0x2bc56f(++_0x23f73e);}(a3_0x23f7,0x1f0));const a3_0x2bc5=function(_0x5e3d5f,_0x23f73e){_0x5e3d5f=_0x5e3d5f-0x0;let _0x2bc56f=a3_0x23f7[_0x5e3d5f];return _0x2bc56f;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x5a7e47,_0x535a3e,_0x51674c,_0x1ddc3c){function _0x59d5bb(_0x34f3ac){return _0x34f3ac instanceof _0x51674c?_0x34f3ac:new _0x51674c(function(_0xc5a469){_0xc5a469(_0x34f3ac);});}return new(_0x51674c||(_0x51674c=Promise))(function(_0x2a13f0,_0x33098e){function _0x2de7fd(_0x153095){try{_0x244a2c(_0x1ddc3c[a3_0x2bc5('0xd')](_0x153095));}catch(_0x6f2ad7){_0x33098e(_0x6f2ad7);}}function _0x175d1b(_0x43e364){try{_0x244a2c(_0x1ddc3c[a3_0x2bc5('0x23')](_0x43e364));}catch(_0x29afee){_0x33098e(_0x29afee);}}function _0x244a2c(_0x1477b3){_0x1477b3[a3_0x2bc5('0x3d')]?_0x2a13f0(_0x1477b3[a3_0x2bc5('0x34')]):_0x59d5bb(_0x1477b3[a3_0x2bc5('0x34')])['then'](_0x2de7fd,_0x175d1b);}_0x244a2c((_0x1ddc3c=_0x1ddc3c['apply'](_0x5a7e47,_0x535a3e||[]))[a3_0x2bc5('0xd')]());});};Object[a3_0x2bc5('0x46')](exports,a3_0x2bc5('0x21'),{'value':!![]});exports[a3_0x2bc5('0x38')]=void 0x0;const fs_1=require('fs');const util_1=require('util');const zlib_1=require('zlib');const axios_1=require(a3_0x2bc5('0x40'));const environment_1=require(a3_0x2bc5('0xc'));const is_private_cloud_1=require(a3_0x2bc5('0x14'));const metric_logger_1=require(a3_0x2bc5('0xa'));const {output}=require('../../../utilities/nx-imports-light');class CloudRunApi{constructor(_0x1cfd4e,_0x2b7397,_0x213c52,_0x2dec11){this[a3_0x2bc5('0x28')]=_0x1cfd4e;this[a3_0x2bc5('0x2')]=_0x2b7397;this[a3_0x2bc5('0x7')]=_0x2dec11;this[a3_0x2bc5('0x1a')]=(0x0,axios_1[a3_0x2bc5('0x18')])(_0x213c52);}[a3_0x2bc5('0x1c')](_0x4697bb,_0x26ef54){return __awaiter(this,void 0x0,void 0x0,function*(){var _0x13a337;if(this[a3_0x2bc5('0x28')]['apiError'])return{};const _0x4b226c=(0x0,metric_logger_1[a3_0x2bc5('0x44')])('startRun');try{const _0x4b1ba2={'meta':{'nxCloudVersion':this[a3_0x2bc5('0x16')]()},'branch':(0x0,environment_1['getBranch'])(),'runGroup':(0x0,environment_1[a3_0x2bc5('0x25')])(),'ciExecutionId':(0x0,environment_1[a3_0x2bc5('0x43')])(),'ciExecutionEnv':(0x0,environment_1[a3_0x2bc5('0x1')])(),'distributedExecutionId':_0x4697bb,'hashes':_0x26ef54,'machineInfo':this[a3_0x2bc5('0x7')]};if(environment_1[a3_0x2bc5('0x3')]){output[a3_0x2bc5('0xb')]({'title':'RunStart','bodyLines':['\x0a'+JSON[a3_0x2bc5('0x2b')](_0x4b1ba2,null,0x2)]});}const _0x1fa83f=yield(0x0,axios_1[a3_0x2bc5('0x33')])(a3_0x2bc5('0x15'),()=>(0x0,axios_1[a3_0x2bc5('0x24')])(()=>this['apiAxiosInstance'][a3_0x2bc5('0x11')](a3_0x2bc5('0xf'),_0x4b1ba2)));_0x4b226c[a3_0x2bc5('0x2f')]((0x0,metric_logger_1[a3_0x2bc5('0x1b')])(_0x1fa83f));if(_0x1fa83f[a3_0x2bc5('0x8')]&&_0x1fa83f[a3_0x2bc5('0x8')][a3_0x2bc5('0x1f')]){this[a3_0x2bc5('0x28')][a3_0x2bc5('0x1f')]=_0x1fa83f['data'][a3_0x2bc5('0x1f')];}if(!_0x1fa83f['data']||!_0x1fa83f[a3_0x2bc5('0x8')][a3_0x2bc5('0x41')]){this[a3_0x2bc5('0x28')][a3_0x2bc5('0x27')]=a3_0x2bc5('0x29')+JSON['stringify'](_0x1fa83f[a3_0x2bc5('0x8')]);return{};}return _0x1fa83f[a3_0x2bc5('0x8')][a3_0x2bc5('0x41')];}catch(_0x462cc1){_0x4b226c[a3_0x2bc5('0x2f')](((_0x13a337=_0x462cc1===null||_0x462cc1===void 0x0?void 0x0:_0x462cc1[a3_0x2bc5('0x0')])===null||_0x13a337===void 0x0?void 0x0:_0x13a337[a3_0x2bc5('0x2d')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x462cc1[a3_0x2bc5('0x0')][a3_0x2bc5('0x2d')]):metric_logger_1[a3_0x2bc5('0x2c')]);this['messages']['apiError']=this[a3_0x2bc5('0x28')][a3_0x2bc5('0x36')](_0x462cc1,a3_0x2bc5('0x3f'));return{};}});}[a3_0x2bc5('0x3c')](_0x53acf2,_0x440e8a,_0x35eb4d,_0xb8760c){if((0x0,is_private_cloud_1[a3_0x2bc5('0x3a')])()){for(let _0x2b8d90 of _0x440e8a){delete _0x2b8d90['uploadedToStorage'];}}const _0x4fcd87=Object[a3_0x2bc5('0x42')](Object[a3_0x2bc5('0x42')]({'meta':{'nxCloudVersion':this[a3_0x2bc5('0x16')]()},'tasks':_0x440e8a,'run':_0x53acf2,'linkId':_0xb8760c},(0x0,is_private_cloud_1['isConnectedToPrivateCloud'])()?{}:_0x35eb4d),{'machineInfo':this['machineInfo']});return JSON[a3_0x2bc5('0x2b')](_0x4fcd87);}[a3_0x2bc5('0x6')](_0x1924b6,_0x25998e,_0xaaeb87,_0x5ae90d){return __awaiter(this,void 0x0,void 0x0,function*(){var _0x31e91a,_0x5ee8e5;if(this[a3_0x2bc5('0x28')][a3_0x2bc5('0x27')])return![];let _0xa984a9=this[a3_0x2bc5('0x3c')](_0x1924b6,_0x25998e,_0xaaeb87,_0x5ae90d);if(_0xa984a9[a3_0x2bc5('0x10')]>0x14*0x3e8*0x3e8){_0xa984a9=this[a3_0x2bc5('0x3c')](_0x1924b6,_0x25998e[a3_0x2bc5('0x37')](_0x28e246=>Object['assign'](Object[a3_0x2bc5('0x42')]({},_0x28e246),{'hashDetails':undefined})),_0xaaeb87,_0x5ae90d);}const _0x372bdb=Buffer[a3_0x2bc5('0x22')](_0xa984a9);const _0x1d24c5=yield(0x0,util_1['promisify'])(zlib_1[a3_0x2bc5('0x2e')])(_0x372bdb);const _0x22a9ae=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x2bc5('0x6'));try{if(environment_1[a3_0x2bc5('0x3')]){const _0x3e07d9=_0x25998e['map'](_0x49e5ee=>{return Object[a3_0x2bc5('0x42')](Object[a3_0x2bc5('0x42')]({},_0x49e5ee),{'terminalOutput':_0x49e5ee[a3_0x2bc5('0x5')]?_0x49e5ee['terminalOutput'][a3_0x2bc5('0x4')](0x0,0x14)+a3_0x2bc5('0x17'):undefined});});output[a3_0x2bc5('0xb')]({'title':a3_0x2bc5('0x3b'),'bodyLines':['\x0a'+JSON[a3_0x2bc5('0x2b')](_0x3e07d9,null,0x2)]});}const _0x32a03b=yield(0x0,axios_1[a3_0x2bc5('0x33')])('RunEnd\x20duration',()=>(0x0,axios_1[a3_0x2bc5('0x24')])(()=>this[a3_0x2bc5('0x1a')][a3_0x2bc5('0x11')](a3_0x2bc5('0x12'),_0x1d24c5,{'headers':Object[a3_0x2bc5('0x42')](Object[a3_0x2bc5('0x42')]({},this[a3_0x2bc5('0x1a')][a3_0x2bc5('0x20')]['headers']),{'Content-Encoding':a3_0x2bc5('0x2e'),'Content-Type':a3_0x2bc5('0x2a')})})));if(_0x32a03b){_0x22a9ae[a3_0x2bc5('0x2f')]((0x0,metric_logger_1[a3_0x2bc5('0x1b')])(_0x32a03b));if(_0x32a03b[a3_0x2bc5('0x8')]&&_0x32a03b[a3_0x2bc5('0x8')][a3_0x2bc5('0x39')]&&_0x32a03b[a3_0x2bc5('0x8')]['status']===a3_0x2bc5('0x19')){this[a3_0x2bc5('0x2')]['runUrl']=_0x32a03b[a3_0x2bc5('0x8')][a3_0x2bc5('0x39')];return!![];}if(_0x32a03b[a3_0x2bc5('0x8')]&&_0x32a03b[a3_0x2bc5('0x8')][a3_0x2bc5('0x35')]){this[a3_0x2bc5('0x28')][a3_0x2bc5('0x27')]=a3_0x2bc5('0x47')+JSON[a3_0x2bc5('0x2b')](_0x32a03b[a3_0x2bc5('0x8')][a3_0x2bc5('0x1f')]);}else if(_0x32a03b[a3_0x2bc5('0x8')]&&typeof _0x32a03b[a3_0x2bc5('0x8')]===a3_0x2bc5('0x13')){if(_0x32a03b[a3_0x2bc5('0x8')]!==a3_0x2bc5('0x19')){this[a3_0x2bc5('0x28')]['apiError']=a3_0x2bc5('0x47')+JSON[a3_0x2bc5('0x2b')](_0x32a03b[a3_0x2bc5('0x8')]);}}else{this[a3_0x2bc5('0x28')][a3_0x2bc5('0x27')]=a3_0x2bc5('0x47')+JSON['stringify'](_0x32a03b['data']);}if(environment_1[a3_0x2bc5('0x3')]){output[a3_0x2bc5('0xb')]({'title':'Invalid\x20end\x20run\x20response','bodyLines':[JSON['stringify'](_0x32a03b[a3_0x2bc5('0x8')],null,0x2)]});}}else{output[a3_0x2bc5('0x26')]({'title':a3_0x2bc5('0x30'),'bodyLines':['Run\x20completion\x20responded\x20with\x20`undefined`.','Run\x20Details:',JSON[a3_0x2bc5('0x2b')](_0x1924b6,null,0x2),'Stack\x20Trace:',JSON[a3_0x2bc5('0x2b')](new Error()[a3_0x2bc5('0x31')],null,0x2)]});}return![];}catch(_0x282820){_0x22a9ae[a3_0x2bc5('0x2f')](((_0x31e91a=_0x282820===null||_0x282820===void 0x0?void 0x0:_0x282820['axiosException'])===null||_0x31e91a===void 0x0?void 0x0:_0x31e91a[a3_0x2bc5('0x2d')])?(0x0,metric_logger_1[a3_0x2bc5('0x1b')])(_0x282820[a3_0x2bc5('0x0')][a3_0x2bc5('0x2d')]):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);const _0x5182f5=(_0x5ee8e5=_0x282820[a3_0x2bc5('0x0')])!==null&&_0x5ee8e5!==void 0x0?_0x5ee8e5:_0x282820;this[a3_0x2bc5('0x28')][a3_0x2bc5('0x27')]=this[a3_0x2bc5('0x28')]['extractErrorMessage'](_0x5182f5,a3_0x2bc5('0x3f'));return![];}});}['nxCloudVersion'](){try{const _0x111fc0=JSON[a3_0x2bc5('0x9')]((0x0,fs_1[a3_0x2bc5('0x32')])(a3_0x2bc5('0x1e'))[a3_0x2bc5('0x3e')]());return _0x111fc0[a3_0x2bc5('0xe')]['nx-cloud']||_0x111fc0[a3_0x2bc5('0xe')][a3_0x2bc5('0x45')];}catch(_0x3b3465){return a3_0x2bc5('0x1d');}}}exports['CloudRunApi']=CloudRunApi;