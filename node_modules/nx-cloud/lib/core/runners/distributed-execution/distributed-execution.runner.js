const a11_0x2ad5=['commandStatus','splitTasksIntoStages','warn','processTasks','endTasks','./split-task-graph-into-stages','values','SIGINT','../../../utilities/dte-artifact-storage','__esModule','scheduleTask','DTE\x20needs\x20the\x20cache\x20to\x20share\x20files\x20between\x20agents.','lifeCycle','exit','../../../utilities/nx-imports-light','log','start','VERBOSE_LOGGING','getCIExecutionEnv','canDetectRunGroup','../../error/print-run-group-error','runUrl','completeRunGroupWithError','defineProperty','./task-graph-creator','createStartRequest','printRunGroupError','ErrorReporterApi','next','Main\x20job\x20terminated\x20with\x20an\x20error:\x20\x22','extractGitRef','tasks','done','success','getRunGroup','E2EEncryption','SIGTERM','Unable\x20to\x20complete\x20a\x20run.','Successfully\x20completed\x20running\x20the\x20command.','startTask','Main\x20job\x20was\x20terminated\x20via\x20SIGINT','note','skipNxCache','__awaiter','DistributedExecutionApi','Main\x20job\x20was\x20terminated\x20via\x20SIGTERM','value','taskGraph','See\x20run\x20details\x20at\x20','submitRunMetrics','message','../../../utilities/environment','Starting\x20distributed\x20command\x20execution','--skip-nx-cache\x20is\x20ignored\x20when\x20using\x20distributed\x20tasks\x20execution\x20(DTE).','axiosException','getBranch','../../../utilities/nx-imports','error','../../api/error-reporter.api','createTaskGraphCompat','./distributed-execution.api','projectGraph','extractGitSha','throw','../../../utilities/metric-logger','apply','encryptionKey'];(function(_0x2c148b,_0x2ad56b){const _0x4ffc1e=function(_0x3c988d){while(--_0x3c988d){_0x2c148b['push'](_0x2c148b['shift']());}};_0x4ffc1e(++_0x2ad56b);}(a11_0x2ad5,0x11d));const a11_0x4ffc=function(_0x2c148b,_0x2ad56b){_0x2c148b=_0x2c148b-0x0;let _0x4ffc1e=a11_0x2ad5[_0x2c148b];return _0x4ffc1e;};'use strict';var __awaiter=this&&this[a11_0x4ffc('0x1a')]||function(_0x3e59b1,_0x40caf4,_0x5f3c0b,_0x5b0a94){function _0x597c83(_0x15a49d){return _0x15a49d instanceof _0x5f3c0b?_0x15a49d:new _0x5f3c0b(function(_0x25d4fb){_0x25d4fb(_0x15a49d);});}return new(_0x5f3c0b||(_0x5f3c0b=Promise))(function(_0x343f5a,_0x4885eb){function _0x3113a1(_0x531efe){try{_0xdc4e48(_0x5b0a94[a11_0x4ffc('0xb')](_0x531efe));}catch(_0x339da0){_0x4885eb(_0x339da0);}}function _0x12df3e(_0x33c4b9){try{_0xdc4e48(_0x5b0a94[a11_0x4ffc('0x2e')](_0x33c4b9));}catch(_0x55fda5){_0x4885eb(_0x55fda5);}}function _0xdc4e48(_0x3d50cb){_0x3d50cb[a11_0x4ffc('0xf')]?_0x343f5a(_0x3d50cb[a11_0x4ffc('0x1d')]):_0x597c83(_0x3d50cb['value'])['then'](_0x3113a1,_0x12df3e);}_0xdc4e48((_0x5b0a94=_0x5b0a94[a11_0x4ffc('0x30')](_0x3e59b1,_0x40caf4||[]))['next']());});};Object[a11_0x4ffc('0x6')](exports,a11_0x4ffc('0x3b'),{'value':!![]});exports['nxCloudDistributedTasksRunner']=void 0x0;const dte_artifact_storage_1=require(a11_0x4ffc('0x3a'));const environment_1=require(a11_0x4ffc('0x22'));const metric_logger_1=require(a11_0x4ffc('0x2f'));const error_reporter_api_1=require(a11_0x4ffc('0x29'));const print_run_group_error_1=require(a11_0x4ffc('0x3'));const e2e_encryption_1=require('../../file-storage/e2e-encryption');const file_storage_1=require('../../file-storage/file-storage');const distributed_execution_api_1=require(a11_0x4ffc('0x2b'));const process_tasks_1=require('./process-tasks');const split_task_graph_into_stages_1=require(a11_0x4ffc('0x37'));const task_graph_creator_1=require(a11_0x4ffc('0x7'));const {output}=require(a11_0x4ffc('0x40'));const {cacheDirectory}=require(a11_0x4ffc('0x27'));class NoopLifeCycle{[a11_0x4ffc('0x3c')](_0x22b312){}[a11_0x4ffc('0x16')](_0x331400){}[a11_0x4ffc('0x36')](_0x58467f){}}const nxCloudDistributedTasksRunner=(_0x171f34,_0x45b4b4,_0x7623bd)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){if(_0x45b4b4[a11_0x4ffc('0x19')]){output[a11_0x4ffc('0x34')]({'title':a11_0x4ffc('0x24'),'bodyLine':[a11_0x4ffc('0x3d')]});}if(environment_1[a11_0x4ffc('0x0')]){output[a11_0x4ffc('0x18')]({'title':a11_0x4ffc('0x23')});}_0x45b4b4[a11_0x4ffc('0x3e')]=new NoopLifeCycle();const _0x195f1c=(0x0,environment_1[a11_0x4ffc('0x26')])();const _0x43e28d=(0x0,environment_1[a11_0x4ffc('0x11')])();const _0x3f90e9=(0x0,environment_1['getCIExecutionId'])();const _0x599f5b=(0x0,environment_1[a11_0x4ffc('0x1')])();const _0x2bd56d=(0x0,environment_1[a11_0x4ffc('0x2d')])();const _0x2f0c34=(0x0,environment_1[a11_0x4ffc('0xd')])();if(!(0x0,print_run_group_error_1[a11_0x4ffc('0x2')])(_0x43e28d,_0x3f90e9)){(0x0,print_run_group_error_1[a11_0x4ffc('0x9')])();process[a11_0x4ffc('0x3f')](0x1);}const _0x3f02b8=new e2e_encryption_1[(a11_0x4ffc('0x12'))](environment_1['ENCRYPTION_KEY']||_0x45b4b4[a11_0x4ffc('0x31')]);const _0x1910ad=new error_reporter_api_1[(a11_0x4ffc('0xa'))](_0x45b4b4);const _0x58fb8f=new dte_artifact_storage_1['DteArtifactStorage'](new file_storage_1['FileStorage'](_0x3f02b8,_0x1910ad,_0x45b4b4,'dte-main'),cacheDirectory);const _0x1ca560=new distributed_execution_api_1[(a11_0x4ffc('0x1b'))](_0x45b4b4);attachSignalListenersToCompleteRunGroupOnError(_0x1ca560,_0x195f1c,_0x43e28d,_0x3f90e9,_0x599f5b);try{const _0x4abf94=getTaskGraph(_0x7623bd,_0x171f34,_0x45b4b4);const _0x54cf88=yield runDistributedExecution(_0x1ca560,_0x45b4b4,_0x58fb8f,_0x195f1c,_0x43e28d,_0x3f90e9,_0x599f5b,_0x4abf94,_0x2bd56d,_0x2f0c34);if(_0x54cf88[a11_0x4ffc('0x32')]===0x0){output[a11_0x4ffc('0x10')]({'title':a11_0x4ffc('0x15'),'bodyLines':[a11_0x4ffc('0x1f')+_0x54cf88[a11_0x4ffc('0x4')]]});}else{output[a11_0x4ffc('0x28')]({'title':'Command\x20execution\x20failed.','bodyLines':[a11_0x4ffc('0x1f')+_0x54cf88['runUrl']]});}yield(0x0,metric_logger_1[a11_0x4ffc('0x20')])(_0x45b4b4);process[a11_0x4ffc('0x3f')](_0x54cf88['commandStatus']);}catch(_0x3d49ae){output['error']({'title':a11_0x4ffc('0x14'),'bodyLines':[_0x3d49ae[a11_0x4ffc('0x21')]]});if(_0x3d49ae[a11_0x4ffc('0x25')]){console[a11_0x4ffc('0x41')](_0x3d49ae['axiosException']);}else{console[a11_0x4ffc('0x41')](_0x3d49ae);}try{yield _0x1ca560[a11_0x4ffc('0x5')](_0x195f1c,_0x43e28d,_0x3f90e9,_0x599f5b,a11_0x4ffc('0xc')+_0x3d49ae[a11_0x4ffc('0x21')]+'\x22');}finally{process[a11_0x4ffc('0x3f')](0x1);}}});exports['nxCloudDistributedTasksRunner']=nxCloudDistributedTasksRunner;function getTaskGraph(_0x229916,_0x442c51,_0x517a26){if(_0x229916['taskGraph']){return _0x229916[a11_0x4ffc('0x1e')];}else{return(0x0,task_graph_creator_1[a11_0x4ffc('0x2a')])(_0x517a26,_0x229916[a11_0x4ffc('0x2c')],_0x442c51);}}function attachSignalListenersToCompleteRunGroupOnError(_0x449632,_0x59519a,_0x35e713,_0x4ffa56,_0x24e1a9){process['on'](a11_0x4ffc('0x39'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x449632[a11_0x4ffc('0x5')](_0x59519a,_0x35e713,_0x4ffa56,_0x24e1a9,a11_0x4ffc('0x17'));process['exit'](0x1);}));process['on'](a11_0x4ffc('0x13'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x449632[a11_0x4ffc('0x5')](_0x59519a,_0x35e713,_0x4ffa56,_0x24e1a9,a11_0x4ffc('0x1c'));process[a11_0x4ffc('0x3f')](0x1);}));}function runDistributedExecution(_0x5adcfa,_0x2594dd,_0x2c0800,_0x1c0c93,_0x20caeb,_0x553c9b,_0x5a1bae,_0x112d48,_0x1fe7b1,_0x129ad8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x34eb7f=yield _0x5adcfa[a11_0x4ffc('0x42')]((0x0,distributed_execution_api_1[a11_0x4ffc('0x8')])(_0x1c0c93,_0x20caeb,_0x553c9b,_0x5a1bae,(0x0,split_task_graph_into_stages_1[a11_0x4ffc('0x33')])(_0x112d48),_0x2594dd,_0x1fe7b1));return yield(0x0,process_tasks_1[a11_0x4ffc('0x35')])(_0x5adcfa,_0x2c0800,_0x34eb7f,Object[a11_0x4ffc('0x38')](_0x112d48[a11_0x4ffc('0xe')]));});}