"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.everyWeekTrigger = void 0;
const tslib_1 = require("tslib");
const pieces_framework_1 = require("@activepieces/pieces-framework");
const pieces_framework_2 = require("@activepieces/pieces-framework");
const common_1 = require("../common");
exports.everyWeekTrigger = (0, pieces_framework_2.createTrigger)({
    name: 'every_week',
    displayName: 'Every Week',
    description: 'Triggers the current flow every week',
    type: pieces_framework_1.TriggerStrategy.POLLING,
    sampleData: {},
    props: {
        day_of_the_week: pieces_framework_2.Property.StaticDropdown({
            displayName: 'Day of the week',
            options: {
                options: common_1.WEEK_DAYS.map((d, idx) => {
                    return {
                        label: d,
                        value: idx,
                    };
                }),
            },
            required: true,
        }),
        hour_of_the_day: pieces_framework_2.Property.StaticDropdown({
            displayName: 'Hour of the day',
            options: {
                options: common_1.DAY_HOURS.map((h, idx) => {
                    return {
                        label: h,
                        value: idx,
                    };
                }),
            },
            required: true,
        }),
        timezone: pieces_framework_2.Property.StaticDropdown({
            displayName: 'Timezone',
            options: {
                options: common_1.timezoneOptions,
            },
            required: true,
            defaultValue: 'UTC',
        }),
    },
    onEnable: (ctx) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        const hourOfTheDay = (0, common_1.validateHours)(ctx.propsValue.hour_of_the_day);
        const dayOfTheWeek = (0, common_1.validateWeekDays)(ctx.propsValue.day_of_the_week);
        const cronExpression = `0 ${hourOfTheDay} * * ${dayOfTheWeek}`;
        ctx.setSchedule({
            cronExpression: cronExpression,
            timezone: ctx.propsValue.timezone,
        });
    }),
    run(ctx) {
        const hourOfTheDay = (0, common_1.validateHours)(ctx.propsValue.hour_of_the_day);
        const dayOfTheWeek = (0, common_1.validateWeekDays)(ctx.propsValue.day_of_the_week);
        const cronExpression = `0 ${hourOfTheDay} * * ${dayOfTheWeek}`;
        return Promise.resolve([
            {
                hour_of_the_day: hourOfTheDay,
                day_of_the_week: dayOfTheWeek,
                cron_expression: cronExpression,
                timezone: ctx.propsValue.timezone,
            },
        ]);
    },
    onDisable: () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        console.log('onDisable');
    }),
});
//# sourceMappingURL=every-week.trigger.js.map